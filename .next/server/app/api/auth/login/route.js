"use strict";(()=>{var e={};e.id=7758,e.ids=[7758],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},8086:e=>{e.exports=require("module")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},21820:e=>{e.exports=require("os")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},42449:e=>{e.exports=require("pg")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},46193:e=>{e.exports=require("node:string_decoder")},51455:e=>{e.exports=require("node:fs/promises")},55511:e=>{e.exports=require("crypto")},56078:(e,r,t)=>{t.d(r,{HU:()=>d,ON:()=>c,jn:()=>f,l4:()=>m,nr:()=>x,sN:()=>g,vD:()=>h});var s=t(43205),a=t.n(s),i=t(25538),o=t(55511),n=t.n(o);let u=process.env.JWT_SECRET||"your-super-secret-jwt-key-please-change-this",p=process.env.JWT_EXPIRY||"1d",l="auth_token";function d(e){let r={id:e.id,email:e.email,role:e.role,isVerified:e.isVerified,kelasId:e.kelasId};return a().sign(r,u,{expiresIn:p})}function x(e){try{return a().verify(e,u)}catch(e){return console.error("Invalid token:",e),null}}function c(e,r){e.headers.append("Set-Cookie",i.serialize(l,r,{httpOnly:!0,secure:!0,maxAge:86400,path:"/",sameSite:"lax"}))}function m(e){let r={httpOnly:!0,secure:!0,expires:new Date(0),path:"/",sameSite:"lax"};e.headers.append("Set-Cookie",i.serialize(l,"",r))}function f(e){let r=e.cookies.get(l);return r?.value||null}function h(e){let r=f(e);return r?x(r):null}function g(e=32){return n().randomBytes(e).toString("hex")}},57075:e=>{e.exports=require("node:stream")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66703:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>k,routeModule:()=>h,serverHooks:()=>q,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>v});var s={};t.r(s),t.d(s,{POST:()=>f});var a=t(96559),i=t(48088),o=t(37719);t(99180);var n=t(32190),u=t(98765),p=t(93019),l=t(85665),d=t.n(l),x=t(70762),c=t(56078);let m=x.Ik({email:x.Yj().email({message:"Alamat email tidak valid."}),password:x.Yj().min(6,{message:"Kata sandi minimal 6 karakter."})});async function f(e){try{let r=await e.json(),t=m.safeParse(r);if(!t.success)return n.NextResponse.json({message:"Input tidak valid.",errors:t.error.flatten().fieldErrors},{status:400});let{email:s,password:a}=t.data,i=(await (0,u.A)()).getRepository(p.v),o=await i.findOne({where:{email:s}});if(!o||!o.passwordHash||!await d().compare(a,o.passwordHash))return n.NextResponse.json({message:"Email atau kata sandi salah."},{status:401});let l=(0,c.HU)(o),x=n.NextResponse.json({id:o.id,email:o.email,name:o.name,role:o.role,isVerified:o.isVerified,fullName:o.fullName,avatarUrl:o.image});return(0,c.ON)(x,l),x}catch(e){return console.error("Login error:",e),n.NextResponse.json({message:"Terjadi kesalahan internal server."},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/home/user/studio/src/app/api/auth/login/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:g,workUnitAsyncStorage:v,serverHooks:q}=h;function k(){return(0,o.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:v})}},73024:e=>{e.exports=require("node:fs")},73136:e=>{e.exports=require("node:url")},76760:e=>{e.exports=require("node:path")},78474:e=>{e.exports=require("node:events")},79428:e=>{e.exports=require("buffer")},79551:e=>{e.exports=require("url")},79748:e=>{e.exports=require("fs/promises")},83997:e=>{e.exports=require("tty")},94735:e=>{e.exports=require("events")}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4447,580,9013,8117,4958,762,5665,1580],()=>t(66703));module.exports=s})();