"use strict";(()=>{var e={};e.id=3177,e.ids=[3177],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},8086:e=>{e.exports=require("module")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},21820:e=>{e.exports=require("os")},25486:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>v,routeModule:()=>c,serverHooks:()=>g,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>k});var a={};t.r(a),t.d(a,{PUT:()=>x});var s=t(96559),i=t(48088),o=t(37719);t(99180);var n=t(32190),u=t(98765),l=t(93019),p=t(70762),d=t(56078);let m=p.Ik({fullName:p.Yj().min(2,{message:"Nama lengkap minimal 2 karakter."}).optional(),phone:p.Yj().max(20,{message:"Nomor telepon maksimal 20 karakter."}).optional().nullable(),address:p.Yj().max(500,{message:"Alamat maksimal 500 karakter."}).optional().nullable(),birthDate:p.Yj().regex(/^\d{4}-\d{2}-\d{2}$/,{message:"Format tanggal lahir YYYY-MM-DD"}).optional().nullable(),bio:p.Yj().max(300,{message:"Bio maksimal 300 karakter."}).optional().nullable(),avatarUrl:p.Yj().url({message:"URL Avatar tidak valid."}).optional().nullable().or(p.eu(""))});async function x(e){let r=(0,d.vD)(e);if(!r)return n.NextResponse.json({message:"Akses ditolak. Tidak terautentikasi."},{status:401});try{let t=await e.json(),a=m.safeParse(t);if(!a.success)return n.NextResponse.json({message:"Input tidak valid.",errors:a.error.flatten().fieldErrors},{status:400});let s=r.id,i={},o=a.data;if(void 0!==o.fullName&&(i.fullName=o.fullName),void 0!==o.phone&&(i.phone=o.phone),void 0!==o.address&&(i.address=o.address),void 0!==o.birthDate&&(i.birthDate=o.birthDate),void 0!==o.bio&&(i.bio=o.bio),void 0!==o.avatarUrl&&(i.image=o.avatarUrl),0===Object.keys(i).length)return n.NextResponse.json({message:"Tidak ada data untuk diperbarui."},{status:400});let p=(await (0,u.A)()).getRepository(l.v),d=await p.update(s,i);if(0===d.affected)return n.NextResponse.json({message:"Pengguna tidak ditemukan untuk diperbarui."},{status:404});let x=await p.findOne({where:{id:s},select:["id","name","email","emailVerified","image","role","isVerified","fullName","phone","address","birthDate","bio","nis","nip","joinDate","kelasId","mataPelajaran","createdAt","updatedAt"]});return n.NextResponse.json(x,{status:200})}catch(e){return console.error("Update profile error:",e),n.NextResponse.json({message:"Terjadi kesalahan internal server."},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/users/me/profile/route",pathname:"/api/users/me/profile",filename:"route",bundlePath:"app/api/users/me/profile/route"},resolvedPagePath:"/home/user/studio/src/app/api/users/me/profile/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:f,workUnitAsyncStorage:k,serverHooks:g}=c;function v(){return(0,o.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:k})}},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},42449:e=>{e.exports=require("pg")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},46193:e=>{e.exports=require("node:string_decoder")},51455:e=>{e.exports=require("node:fs/promises")},55511:e=>{e.exports=require("crypto")},56078:(e,r,t)=>{t.d(r,{HU:()=>d,ON:()=>x,jn:()=>f,l4:()=>c,nr:()=>m,sN:()=>g,vD:()=>k});var a=t(43205),s=t.n(a),i=t(25538),o=t(55511),n=t.n(o);let u=process.env.JWT_SECRET||"your-super-secret-jwt-key-please-change-this",l=process.env.JWT_EXPIRY||"1d",p="auth_token";function d(e){let r={id:e.id,email:e.email,role:e.role,isVerified:e.isVerified,kelasId:e.kelasId};return s().sign(r,u,{expiresIn:l})}function m(e){try{return s().verify(e,u)}catch(e){return console.error("Invalid token:",e),null}}function x(e,r){e.headers.append("Set-Cookie",i.serialize(p,r,{httpOnly:!0,secure:!0,maxAge:86400,path:"/",sameSite:"lax"}))}function c(e){let r={httpOnly:!0,secure:!0,expires:new Date(0),path:"/",sameSite:"lax"};e.headers.append("Set-Cookie",i.serialize(p,"",r))}function f(e){let r=e.cookies.get(p);return r?.value||null}function k(e){let r=f(e);return r?m(r):null}function g(e=32){return n().randomBytes(e).toString("hex")}},57075:e=>{e.exports=require("node:stream")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:e=>{e.exports=require("node:fs")},73136:e=>{e.exports=require("node:url")},76760:e=>{e.exports=require("node:path")},78474:e=>{e.exports=require("node:events")},79428:e=>{e.exports=require("buffer")},79551:e=>{e.exports=require("url")},79748:e=>{e.exports=require("fs/promises")},83997:e=>{e.exports=require("tty")},94735:e=>{e.exports=require("events")}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[4447,580,9013,8117,4958,762,1580],()=>t(25486));module.exports=a})();