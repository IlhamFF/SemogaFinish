"use strict";(()=>{var e={};e.id=9917,e.ids=[9917],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},8086:e=>{e.exports=require("module")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},20857:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>h,routeModule:()=>k,serverHooks:()=>g,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>w});var s={};t.r(s),t.d(s,{GET:()=>c,POST:()=>m});var a=t(96559),n=t(48088),o=t(37719);t(99180);var i=t(32190),u=t(98765),l=t(33191),p=t(70762),d=t(56078);let x=p.Ik({namaSlot:p.Yj().min(3,{message:"Nama slot minimal 3 karakter."}).max(100),waktuMulai:p.Yj().regex(/^([01]\d|2[0-3]):([0-5]\d)$/,{message:"Format waktuMulai HH:MM, contoh: 07:30"}),waktuSelesai:p.Yj().regex(/^([01]\d|2[0-3]):([0-5]\d)$/,{message:"Format waktuSelesai HH:MM, contoh: 09:00"}),urutan:p.au.number().optional().nullable()}).refine(e=>e.waktuMulai<e.waktuSelesai,{message:"Waktu mulai harus sebelum waktu selesai.",path:["waktuSelesai"]});async function c(e){if(!(0,d.vD)(e))return i.NextResponse.json({message:"Tidak terautentikasi."},{status:401});try{let e=(await (0,u.A)()).getRepository(l.u),r=await e.find({order:{urutan:"ASC",waktuMulai:"ASC"}});return i.NextResponse.json(r)}catch(e){return console.error("Error fetching slot waktu:",e),i.NextResponse.json({message:"Terjadi kesalahan internal server."},{status:500})}}async function m(e){let r=(0,d.vD)(e);if(!r)return i.NextResponse.json({message:"Tidak terautentikasi."},{status:401});if(!["admin","superadmin"].includes(r.role))return i.NextResponse.json({message:"Akses ditolak. Hanya admin yang dapat membuat slot waktu."},{status:403});try{let r=await e.json(),t=x.safeParse(r);if(!t.success)return i.NextResponse.json({message:"Input tidak valid.",errors:t.error.flatten().fieldErrors},{status:400});let{namaSlot:s,waktuMulai:a,waktuSelesai:n,urutan:o}=t.data,p=(await (0,u.A)()).getRepository(l.u);if(await p.findOneBy({namaSlot:s}))return i.NextResponse.json({message:"Nama slot waktu sudah ada."},{status:409});let d=p.create({namaSlot:s,waktuMulai:a,waktuSelesai:n,urutan:o});return await p.save(d),i.NextResponse.json(d,{status:201})}catch(e){if(console.error("Error creating slot waktu:",e),"23505"===e.code)return i.NextResponse.json({message:"Nama slot waktu sudah ada (dari DB)."},{status:409});return i.NextResponse.json({message:"Terjadi kesalahan internal server."},{status:500})}}let k=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/jadwal/slot-waktu/route",pathname:"/api/jadwal/slot-waktu",filename:"route",bundlePath:"app/api/jadwal/slot-waktu/route"},resolvedPagePath:"/home/user/studio/src/app/api/jadwal/slot-waktu/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:f,workUnitAsyncStorage:w,serverHooks:g}=k;function h(){return(0,o.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:w})}},21820:e=>{e.exports=require("os")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},42449:e=>{e.exports=require("pg")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},46193:e=>{e.exports=require("node:string_decoder")},51455:e=>{e.exports=require("node:fs/promises")},55511:e=>{e.exports=require("crypto")},56078:(e,r,t)=>{t.d(r,{HU:()=>d,ON:()=>c,jn:()=>k,l4:()=>m,nr:()=>x,sN:()=>w,vD:()=>f});var s=t(43205),a=t.n(s),n=t(25538),o=t(55511),i=t.n(o);let u=process.env.JWT_SECRET||"your-super-secret-jwt-key-please-change-this",l=process.env.JWT_EXPIRY||"1d",p="auth_token";function d(e){let r={id:e.id,email:e.email,role:e.role,isVerified:e.isVerified,kelasId:e.kelasId};return a().sign(r,u,{expiresIn:l})}function x(e){try{return a().verify(e,u)}catch(e){return console.error("Invalid token:",e),null}}function c(e,r){e.headers.append("Set-Cookie",n.serialize(p,r,{httpOnly:!0,secure:!0,maxAge:86400,path:"/",sameSite:"lax"}))}function m(e){let r={httpOnly:!0,secure:!0,expires:new Date(0),path:"/",sameSite:"lax"};e.headers.append("Set-Cookie",n.serialize(p,"",r))}function k(e){let r=e.cookies.get(p);return r?.value||null}function f(e){let r=k(e);return r?x(r):null}function w(e=32){return i().randomBytes(e).toString("hex")}},57075:e=>{e.exports=require("node:stream")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:e=>{e.exports=require("node:fs")},73136:e=>{e.exports=require("node:url")},76760:e=>{e.exports=require("node:path")},78474:e=>{e.exports=require("node:events")},79428:e=>{e.exports=require("buffer")},79551:e=>{e.exports=require("url")},79748:e=>{e.exports=require("fs/promises")},83997:e=>{e.exports=require("tty")},94735:e=>{e.exports=require("events")}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4447,580,9013,8117,4958,762,1580],()=>t(20857));module.exports=s})();